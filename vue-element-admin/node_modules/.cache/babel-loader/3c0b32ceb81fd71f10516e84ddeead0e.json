{"remainingRequest":"/Users/chenjiahao/GoDemo/go-blog/vue-element-admin/node_modules/babel-loader/lib/index.js!/Users/chenjiahao/GoDemo/go-blog/vue-element-admin/src/store/modules/permission.js","dependencies":[{"path":"/Users/chenjiahao/GoDemo/go-blog/vue-element-admin/src/store/modules/permission.js","mtime":1608023738724},{"path":"/Users/chenjiahao/GoDemo/go-blog/vue-element-admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/chenjiahao/GoDemo/go-blog/vue-element-admin/node_modules/babel-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["\"use strict\";\n\nvar _interopRequireDefault = require(\"/Users/chenjiahao/GoDemo/go-blog/vue-element-admin/node_modules/@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.generaMenu = generaMenu;\nexports.filterAsyncRoutes = filterAsyncRoutes;\nexports.default = void 0;\n\nvar _objectSpread2 = _interopRequireDefault(require(\"/Users/chenjiahao/GoDemo/go-blog/vue-element-admin/node_modules/@babel/runtime-corejs2/helpers/objectSpread2\"));\n\nvar _interopRequireWildcard2 = _interopRequireDefault(require(\"/Users/chenjiahao/GoDemo/go-blog/vue-element-admin/node_modules/@babel/runtime-corejs2/helpers/interopRequireWildcard\"));\n\nrequire(\"core-js/modules/web.dom.iterable\");\n\nrequire(\"core-js/modules/es7.array.includes\");\n\nrequire(\"core-js/modules/es6.string.includes\");\n\nvar _router = require(\"@/router\");\n\nvar _user = require(\"@/api/user\");\n\nvar _layout = _interopRequireDefault(require(\"@/layout\"));\n\n/**\n * Use meta.role to determine if the current user has permission\n * @param roles\n * @param route\n */\nfunction hasPermission(roles, route) {\n  if (route.meta && route.meta.roles) {\n    return roles.some(function (role) {\n      return route.meta.roles.includes(role);\n    });\n  } else {\n    return true;\n  }\n}\n/**\n * 后台查询的菜单数据拼装成路由格式的数据\n * @param routes\n */\n\n\nfunction generaMenu(routes, data) {\n  data.forEach(function (item) {\n    // alert(JSON.stringify(item))\n    var menu = {\n      path: item.path === '#' ? item.id + '_key' : item.path,\n      component: item.component === '#' ? _layout.default : function () {\n        return Promise.resolve().then(function () {\n          return (0, _interopRequireWildcard2.default)(require(\"@/views\".concat(item.component)));\n        });\n      },\n      hidden: item.hidden,\n      redirect: item.redirect,\n      children: [],\n      name: 'menu_' + item.id,\n      meta: item.meta // meta: { title: item.name, id: item.id, roles: ['admin'] }\n\n    };\n\n    if (item.children) {\n      generaMenu(menu.children, item.children);\n    }\n\n    routes.push(menu);\n  });\n}\n/**\n * Filter asynchronous routing tables by recursion\n * @param routes asyncRoutes\n * @param roles\n */\n\n\nfunction filterAsyncRoutes(routes, roles) {\n  var res = [];\n  routes.forEach(function (route) {\n    var tmp = (0, _objectSpread2.default)({}, route);\n\n    if (hasPermission(roles, tmp)) {\n      if (tmp.children) {\n        tmp.children = filterAsyncRoutes(tmp.children, roles);\n      }\n\n      res.push(tmp);\n    }\n  });\n  return res;\n}\n\nvar state = {\n  routes: [],\n  addRoutes: []\n};\nvar mutations = {\n  SET_ROUTES: function SET_ROUTES(state, routes) {\n    state.addRoutes = routes;\n    state.routes = _router.constantRoutes.concat(routes);\n  }\n};\nvar actions = {\n  generateRoutes: function generateRoutes(_ref, roles) {\n    var commit = _ref.commit;\n    return new Promise(function (resolve) {\n      var loadMenuData = []; // 先查询后台并返回左侧菜单数据并把数据添加到路由\n\n      (0, _user.getAuthMenu)(state.token).then(function (response) {\n        var data = response;\n\n        if (response.code !== 20000) {\n          alert(JSON.stringify('菜单数据加载异常')); // throw new Error('菜单数据加载异常')\n        } else {\n          data = response.data;\n          Object.assign(loadMenuData, data);\n          var tempAsyncRoutes = Object.assign([], _router.asyncRoutes); // tempAsyncRoutes = asyncRoutes\n\n          generaMenu(tempAsyncRoutes, loadMenuData);\n          var accessedRoutes;\n\n          if (roles.includes('admin')) {\n            // alert(JSON.stringify(asyncRoutes))\n            accessedRoutes = tempAsyncRoutes || [];\n          } else {\n            accessedRoutes = filterAsyncRoutes(tempAsyncRoutes, roles);\n          }\n\n          commit('SET_ROUTES', accessedRoutes);\n          resolve(accessedRoutes);\n        } // generaMenu(asyncRoutes, data)\n\n      }).catch(function (error) {\n        console.log(error);\n      });\n    });\n  }\n};\nvar _default = {\n  namespaced: true,\n  state: state,\n  mutations: mutations,\n  actions: actions\n};\nexports.default = _default;",null]}